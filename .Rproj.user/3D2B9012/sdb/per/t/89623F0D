{
    "collab_server" : "",
    "contents" : "##### Preamble This script cleans the raw historical occupation data gathered from the Historical Census and\n##### Colonial Data Archive at the Australian Data Archive.  Author: Rohan Alexander Email:\n##### rohan.alexander@anu.edu.au Date: 9 April 2016\n\n\n\n\n##### Packages install.packages('tidyverse') install.packages('magrittr')\nlibrary(tidyverse)\nlibrary(magrittr)\n# tidyverse_update() update.packages()\n\n\n\n\n#### 1846 Change working directory\nsetwd(\"~/Dropbox/PhD/pineapple/output/census\")\n# Load the data to be cleaned.\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1846/NSW-1846-census-01_11.Rda\")\n# Fix the column names\ncolnames(page_data) <- c(\"AreaName\", \"Commerce, Trade, and Manufacture\", \"Agriculture\", \"Grazing - Shepherds and persons in the management of Sheep\",\n    \"Grazing - Stockmen and persons in the management of Horses & Cattle\", \"Horticulture\", \"Other Labourers\",\n    \"Mechanics and Artificers\", \"Domestic Servants - Males\", \"Domestic Servants - Females\", \"Clerical Profession\",\n    \"Legal Profession\", \"Medical Profession\", \"Other educated Persons\", \"Alms-people, Pensioners, Paupers\", \"All other occupations\",\n    \"Residue of Population\", \"General Totals\")\n# Get rid of unnecessary rows\npage_data <- page_data[5:nrow(page_data), ]\nrownames(page_data) <- c(1:nrow(page_data))\npage_data <- rbind(page_data[1:24, ], page_data[26:nrow(page_data), ])\nrownames(page_data) <- c(1:nrow(page_data))\n# Add an area type column\npage_data$AreaType <- c(rep(\"County\", 20), \"Total\", \"Other\", \"Other\", \"Total\", rep(\"Squatting Districts\", 11),\n    \"Total\", \"Total\")\n# Covert all the number columns to numeric\ncols = c(2:(ncol(page_data) - 1))\npage_data[, cols] %<>% lapply(function(x) gsub(\",\", \"\", x))\npage_data[, cols] %<>% lapply(function(x) as.numeric(as.character(x)))\nrm(cols)\n# Reorder the columns\npage_data <- select(page_data, AreaName, AreaType, everything())\n# Add source\npage_data$Source = \"http://hccda.ada.edu.au/pages/NSW-1846-census-01_11\"\n# Save the dataframe\nsave(page_data, file = \"1846/OccuptionbyCountyandDistrict.Rda\")\nrm(page_data)\n\n\n\n\n#### 1851 Change working directory\nsetwd(\"~/Dropbox/PhD/pineapple/output/census\")\n# Load the data to be cleaned.\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1851/NSW-1851-census-01_11.Rda\")\n# Fix the column names\ncolnames(page_data) <- c(\"AreaName\", \"Commerce, Trade, and Manufacture\", \"Agriculture\", \"Grazing - Shepherds and Persons in the management of Sheep\",\n    \"Grazing - Stockmen and persons in the management of horses and cattle\", \"Horticulture\", \"Other Laborers\",\n    \"Mechanics and Artificers\", \"Domestic Servants - Male\", \"Domestic Servants - Female\", \"Clerical profession\",\n    \"Legal profession\", \"Medical profession\", \"Other educated persons\", \"Alms-people, Pensioners, Paupers\", \"All other occupations\",\n    \"Residue of Population\", \"General Totals\")\n# Get rid of unnecessary rows\npage_data <- rbind(page_data[4:26, ], page_data[28:nrow(page_data), ])\nrownames(page_data) <- c(1:nrow(page_data))\n# Add an area type column\npage_data$AreaType <- c(rep(\"County\", 20), \"Total\", \"Other\", \"Total\", rep(\"Squatting Districts\", 17), \"Total\",\n    \"Total\")\n# Covert all the number columns to numeric\ncols = c(2:(ncol(page_data) - 1))\npage_data[, cols] %<>% lapply(function(x) gsub(\",\", \"\", x))\npage_data[, cols] %<>% lapply(function(x) as.numeric(as.character(x)))\nrm(cols)\n# Reorder the columns\npage_data <- select(page_data, AreaName, AreaType, everything())\n# Add source\npage_data$Source = \"http://hccda.ada.edu.au/pages/NSW-1851-census-01_11\"\n# Save the dataframe\nsave(page_data, file = \"1851/OccuptionbyCountyandDistrict.Rda\")\nrm(page_data)\n\n\n\n\n#### 1856 Change working directory\nsetwd(\"~/Dropbox/PhD/pineapple/output/census\")\n# Load the data to be cleaned.\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1856/NSW-1856-census-04_16.Rda\")\n# Fix the column names\ncolnames(page_data) <- c(\"AreaName\", \"Trade And Commerce - M\", \"Trade And Commerce - F\", \"Agriculture\", \"Grazing - Sheep\",\n    \"Grazing - Cattle And Horses\", \"Horticulture\", \"Winegrowing\", \"Mining - Precious Metals\", \"Mining - Inferior Metals\",\n    \"Mining - Coal\", \"Artificers\", \"Unskilled Labourers\", \"Mariners\", \"Domestic Service - M\", \"Domestic Service - F\",\n    \"Learned Professions - Legal\", \"Learned Professions - Medical\", \"Learned Professions - Clerical\", \"Teachers - M\",\n    \"Teachers - F\", \"Other Educated Professions - M\", \"Other Educated Professions - F\", \"Almspeople - M\", \"Almspeople - F\",\n    \"Miscellaneous Occupations - M\", \"Miscellaneous Occupations - F\", \"Occupations Not Stated - M\", \"Occupations Not Stated - F\",\n    \"Totals - Males\", \"Totals - Females\", \"Totals - Persons\")\n# Get rid of unnecessary rows\npage_data <- rbind(page_data[2:nrow(page_data), ])\nrownames(page_data) <- c(1:nrow(page_data))\n# Add an area type column\npage_data$AreaType <- c(rep(\"County\", 20), \"Total\", \"Other\", \"Total\", rep(\"Squatting Districts\", 19), \"Total\",\n    \"Total\")\n# Covert all the number columns to numeric\ncols = c(2:(ncol(page_data) - 1))\npage_data[, cols] %<>% lapply(function(x) gsub(\",\", \"\", x))\npage_data[, cols] %<>% lapply(function(x) as.numeric(as.character(x)))\nrm(cols)\n# Reorder the columns\npage_data <- select(page_data, AreaName, AreaType, everything())\n# Add source\npage_data$Source = \"http://hccda.ada.edu.au/pages/NSW-1856-census-04_16\"\n# Save the dataframe\nsave(page_data, file = \"1856/OccuptionbyCountyandDistrict.Rda\")\nrm(page_data)\n\n\n\n\n#### 1861 Change working directory\nsetwd(\"~/Dropbox/PhD/pineapple/output/census\")\n# Write a function that can be used to merge the data for 1861\nmerge_function <- function(data1, data2, year) {\n    file_name_1 = paste(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/\", year, \"/\", \"NSW-1861-census-05-\",\n        data1, \".Rda\", sep = \"\")\n    load(file_name_1)\n    even <- page_data\n    file_name_2 = paste(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/\", year, \"/\", \"NSW-1861-census-05-\",\n        data2, \".Rda\", sep = \"\")\n    load(file_name_2)\n    odd <- page_data\n    odd <- odd[2:nrow(odd), ]\n    if (nrow(even) == nrow(odd)) {\n        both <- cbind(even, odd)\n        setwd(\"~/Dropbox/PhD/pineapple/output/census/1861/temp/\")\n        save_name = paste(\"NSW-1861-census-05-\", data1, \".Rda\", sep = \"\")\n        save(both, file = save_name)\n        print(paste(\"Done with \", data1, \" and \", data2))\n    } else {\n        print(paste(\"Error with \", data1, \" and \", data2, \" at \", Sys.time()))\n    }\n}\n# Use the function\ngo_get_these_files <- seq(450, 480, by = 2)\nfor (i in go_get_these_files) {\n    merge_function(i, i + 1, 1861)\n}\nrm(i)\n# Clean up the one with a mistake - Row 33 and 34 are repeated in NSW-1861-census-05-479 and should be\n# removed. http://hccda.ada.edu.au/pages/NSW-1861-census-05_479\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1861/NSW-1861-census-05-478.Rda\")\neven <- page_data\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1861/NSW-1861-census-05-479.Rda\")\nodd <- page_data\nrm(page_data)\nodd <- rbind(odd[2:32, ], odd[35:nrow(odd), ])\nrownames(odd) <- c(1:nrow(odd))\nboth <- cbind(even, odd)\nsetwd(\"~/Dropbox/PhD/pineapple/output/census/1861/temp/\")\nsave_name = paste(\"NSW-1861-census-05-\", 478, \".Rda\", sep = \"\")\nsave(both, file = save_name)\nrm(both, even, odd, save_name)\n# Pull them together Check they have the same number of columns\nfor (data_set_number in go_get_these_files) {\n    file_name = paste(\"/Users/rohanalexander/Dropbox/PhD/pineapple/output/census/1861/temp/NSW-1861-census-05-\",\n        data_set_number, \".Rda\", sep = \"\")\n    load(file_name)\n    print(ncol(both))\n}\nrm(file_name, data_set_number, both)\n# Bind them together\ndata = NA\nfor (data_set_number in go_get_these_files) {\n    file_name = paste(\"/Users/rohanalexander/Dropbox/PhD/pineapple/output/census/1861/temp/NSW-1861-census-05-\",\n        data_set_number, \".Rda\", sep = \"\")\n    load(file_name)\n    colnames(both) <- NULL\n    colnames(both) <- colnames(both, do.NULL = FALSE, prefix = \"X\")\n    data <- rbind(data, both)\n}\n# Clean up\nrm(both, data_set_number, file_name, go_get_these_files)\n# Go through the merged file and clean up so that long file can be used\ndata <- data[4:nrow(data), ]\n# Get rid of the debris headings that are part of the dataset because of the merge\ndata <- data %>% filter((X2 != \"COUNTIES.\" & X3 != \"PERSONS.\"))\n# Covert all the number columns to numeric\ncols = c(3:(ncol(data)))\ndata[, cols] %<>% lapply(function(x) gsub(\",\", \"\", x))\ndata[, cols] %<>% lapply(function(x) as.numeric(as.character(x)))\nrm(cols)\n# Isolate county names in a separate column. They seem to have a row that has total\ndata$dash <- regexpr(\"^Total$\", data$X1)\ndata$dashed <- lag(data$dash, 1)\ndata$dash <- ifelse((data$dash == 1 | data$dashed == 1), 1, NA)\ndata$dashed <- NULL\ndata$dash[1] <- 1\ndata$dash[825:nrow(data)] <- 1\ndata <- filter(data, dash == 1)\ndata$dash <- regexpr(\"COUNTY.\", data$X1)\ndata$dash <- ifelse(data$dash == -1, regexpr(\"DISTRICT.\", data$X1), data$dash)\ndata$dash <- ifelse(data$dash == -1, regexpr(\"DIST.\", data$X1), data$dash)\ndata$area_name <- ifelse(data$dash != -1, data$X1, NA)\ndata$area_name[97] <- \"Totals\"\ndata <- fill(data, area_name)\ndata <- filter(data, dash == -1)\ndata$X2 <- ifelse(data$X2 == \"\", \"Total\", data$X2)\ndata$X1 <- ifelse(data$X2 == \"Total\", NA, data$X1)\ndata <- fill(data, X1)\ndata$area_name <- ifelse(data$area_name == \"Totals\", data$X1, data$area_name)\ndata$X1 <- NULL\ndata$dash <- NULL\n# Recode the gender/totals column\ndata$X2 <- recode(data$X2, M = \"Male\", F = \"Female\")\n# Add an area_type column\ndata$area_type <- NA\ndata$area_type <- ifelse(regexpr(\"COUNTY.\", data$area_name) != -1, \"County\", data$area_type)\ndata$area_type <- ifelse(regexpr(\"DISTRICT.\", data$area_name) != -1, \"Pastoral district\", data$area_type)\ndata$area_type <- ifelse(regexpr(\"DIST.\", data$area_name) != -1, \"Pastoral district\", data$area_type)\ndata$area_type <- ifelse(is.na(data$area_type), \"Total\", data$area_type)\n# Reorder the columns\ndata <- select(data, area_name, area_type, everything())\n# Fix the column names\ncolnames(data) <- c(\"area_name\", \"area_type\", \"sex\", \"total\", \"GOVERNMENT SERVICE - Civil Officers and Subordinates\",\n    \"GOVERNMENT SERVICE - Police Magistrates, Constables\", \"GOVERNMENT SERVICE - Military and Naval\", \"LEARNED PROFESSIONS - Judicial and Legal\",\n    \"LEARNED PROFESSIONS - Medical and Surgical\", \"LEARNED PROFESSIONS - Clerical\", \"EDUCATED PROFESSIONS - Teachers and Professors\",\n    \"EDUCATED PROFESSIONS - Other Educated Professions\", \"SCHOLARS UNDER TUITION - At Home\", \"SCHOLARS UNDER TUITION - At School\",\n    \"TRADING AND COMMERCE\", \"PROVIDERS OF FOOD, DRINKS, AND ACCOMMODATION - Producers of Food and Drink\", \"PROVIDERS OF FOOD, DRINKS, AND ACCOMMODATION - Distributors\",\n    \"PROVIDERS OF FOOD, DRINKS, AND ACCOMMODATION - Of Food and Drinks, with Accommodation\", \"SKILLED WORKMEN AND ARTIFICERS - In the Superior Arts - Masters\",\n    \"SKILLED WORKMEN AND ARTIFICERS - In the Superior Arts - Servants\", \"SKILLED WORKMEN AND ARTIFICERS - In the Metals - Masters\",\n    \"SKILLED WORKMEN AND ARTIFICERS - In the Metals - Servants\", \"SKILLED WORKMEN AND ARTIFICERS - In Wood - Masters\",\n    \"SKILLED WORKMEN AND ARTIFICERS - In Wood - Servants\", \"SKILLED WORKMEN AND ARTIFICERS - In Stone and Earth - Masters\",\n    \"SKILLED WORKMEN AND ARTIFICERS - In Stone and Earth - Servants\", \"SKILLED WORKMEN AND ARTIFICERS - In Leather and Skins - Masters\",\n    \"SKILLED WORKMEN AND ARTIFICERS - In Leather and Skins - Servants\", \"SKILLED WORKMEN AND ARTIFICERS - In other Materials - Masters\",\n    \"SKILLED WORKMEN AND ARTIFICERS - In other Materials - Servants\", \"MINING - In the Precious Metals\", \"MINING - In the Inferior Metals\",\n    \"MINING - In Coal\", \"AGRICULTURE - Proprietors employing Men\", \"AGRICULTURE - Tenant Farmers employing\", \"AGRICULTURE - Hired Farm Servants\",\n    \"PASTORAL - Sheep - Proprietors of Sheep Farms\", \"PASTORAL - Sheep - Lessees and Licensees\", \"PASTORAL - Sheep - Shepherds, Hutkeepers\",\n    \"PASTORAL - Cattle, Horses - Farm Proprietors\", \"PASTORAL - Cattle, Horses - Lessees and Licensees\", \"PASTORAL - Cattle, Horses - Hired Stockmen, Grooms\",\n    \"HORTICULTURE - Masters employing\", \"HORTICULTURE - Hired Servants\", \"WINEGROWING - Proprietors\", \"WINEGROWING - Hired Vinedressers\",\n    \"UNSKILLED WORKMEN NOT OTHERWISE CLASSIFIED\", \"DOMESTICS - Not hired\", \"DOMESTICS - Hired Servants\", \"SEAFARING PERSONS - Masters, Officers, Pilots\",\n    \"SEAFARING PERSONS - Able Seamen, Divers\", \"SEAFARING PERSONS - Ordinary Seamen, Lumpers\", \"PERSONS RECEIVING PUBLIC SUPPORT GRATUITOUSLY\",\n    \"MISCELLANEOUS OCCUPATIONS\", \"OCCUPATIONS NOT STATED\")\n# Fix the area_name names\ndata$area_name <- recode(data$area_name, `ARGYLE COUNTY.` = \"Argyle\", `BATHURST COUNTY.` = \"Bathurst\", `BLIGH COUNTY.` = \"Bligh\",\n    `BRISBANE COUNTY.` = \"Brisbane\", `CAMDEN COUNTY.` = \"Camden\", `COOK COUNTY.` = \"Cook\", `CUMBERLAND COUNTY.` = \"Cumberland\",\n    `DURHAM COUNTY.` = \"Durham\", `GEORGIANA COUNTY.` = \"Georgiana\", `GLOUCESTER COUNTY.` = \"Gloucester\", `HUNTER COUNTY.` = \"Hunter\",\n    `KING COUNTY.` = \"King\", `MACQUARIE COUNTY.` = \"Macquarie\", `MURRAY COUNTY.` = \"Murray\", `NORTHUMBERLAND COUNTY.` = \"Northumberland\",\n    `PHILLIP COUNTY.` = \"Phillip\", `ROXBURGH COUNTY.` = \"Roxburgh\", `ST. VINCENT COUNTY.` = \"St. Vincent\", `WELLINGTON COUNTY.` = \"Wellington\",\n    `WESTMORELAND COUNTY.` = \"Westmoreland\", `ALBERT PASTORAL DISTRICT.` = \"Albert\", `CLARENCE PASTORAL DISTRICT.` = \"Clarence\",\n    `DARLING PASTORAL DISTRICT.` = \"Darling\", `GWYDIR PASTORAL DISTRICT.` = \"Gwydir\", `LACHLAN PASTORAL DISTRICT.` = \"Lachlan\",\n    `LIVERPOOL PLAINS PASTORAL DISTRICT.` = \"Liverpool Plains\", `MACLEAY PASTORAL DISTRICT.` = \"Macleay\", `MONARO PASTORAL DISTRICT.` = \"Monaro\",\n    `MURRUMBIDGEE PASTORAL DISTRICT.` = \"Murrumbidgee\", `NEW ENGLAND PASTORAL DIST.` = \"New England\", `WARREGO PASTORAL DISTRICT.` = \"Warrego\",\n    `WELLINGTON PASTORAL DIST.` = \"Wellington\")\ndata$area_name[data$area_name == \"GRAND Total of the Colony, not including Crews of its Vessels at Sea, nor the houseless Aborigines\"] <- \"NSW\"\ndata$area_name[data$area_name == \"Total of the Thirteen Pastoral District\"] <- \"Pastoral districts\"\ndata$area_name[data$area_name == \"Total of the Twenty Counties\"] <- \"Counties\"\ndata$area_name[data$area_name == \"ADD the Shipping, which, with a few exceptions, has not been included in the previous tabulation\"] <- \"Shipping\"\n# Save the data\nsave(data, file = \"1861/OccupationsByCounties.Rda\")\n\n\n\n\n#### 1871 NOT DONE YET - IS EVERYTHING FUCKED WITH THIS DATA - MANY WORKS NEEDED??????\n# There's an error in http://hccda.ada.edu.au/pages/NSW-1871-census-03_1076 (weirdo 2 in the wrong column)\n\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1871/NSW-1871-census-03-1076.Rda\")\n\nold_data0 <- page_data\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1871/NSW-1871-census-03-1078.Rda\")\nold_data1 <- page_data\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1871/NSW-1871-census-03-1080.Rda\")\nold_data2 <- page_data\n\n\n\n\n#### 1891 Change working directory\nsetwd(\"~/Dropbox/PhD/pineapple/output/census\")\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1891/NSW-1891-census-02-626.Rda\")\nold_data <- page_data\nfor (i in seq(627, 639)) {\n    new_file_name = paste(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1891/NSW-1891-census-02-\",\n        i, \".Rda\", sep = \"\")\n    load(new_file_name)\n    new_data <- page_data\n    if (ncol(old_data) == ncol(page_data)) {\n        old_data <- rbind(old_data, page_data)\n        print(paste(\"Done with \", i))\n    } else {\n        print(paste(\"Error with \", i, \" at \", Sys.time()))\n    }\n}\ncensus_data <- old_data\nrm(new_file_name, i, new_data, page_data, old_data)\n# Make the headings easier to work with\ncolnames(census_data) <- NULL\ncolnames(census_data) <- colnames(census_data, do.NULL = FALSE, prefix = \"X\")\n# Remove some debris rows\ncensus_data <- filter(census_data, X2 != \"Population.\")\n# Isolate county names in a separate column. They seem to end with '—'\ncensus_data$dash <- regexpr(\"—$\", census_data$X1)\ncensus_data$area_name <- ifelse(census_data$dash != -1, census_data$X1, NA)\ncensus_data <- fill(census_data, area_name)\ncensus_data <- filter(census_data, dash == -1)\ncensus_data$dash <- NULL\n# Remove the '—' from area_name\ncensus_data$area_name <- gsub(\"—\", \"\", census_data$area_name)\n# Reorder the columns\ncensus_data <- select(census_data, area_name, everything())\n# Covert all the number columns to numeric\ncols = c(3:(ncol(census_data)))\ncensus_data[, cols] %<>% lapply(function(x) gsub(\",\", \"\", x))\ncensus_data[, cols] %<>% lapply(function(x) as.numeric(as.character(x)))\nrm(cols)\n# Fix the column names\ncolnames(census_data) <- c(\"area_name\", \"sex\", \"Population\", \"Professional (including Government not elsewhere classed)\",\n    \"Domestic\", \"Commercial - Mercantile Pursuits\", \"Commercial - Transport and Communication\", \"Industrial - Manufacturing\",\n    \"Industrial - Building and Construction\", \"Industrial - Indefinite\", \"Primary Producers - Agricultural\", \"Primary Producers - Pastoral\",\n    \"Primary Producers - Mining\", \"Primary Producers - Other Primary Producers\", \"Indefinite Occupations\", \"Dependent\",\n    \"Occupation not stated\")\n# Save the data\nsave(census_data, file = \"1891/OccupationsByCounty.Rda\")\n\n\n\n\n#### 1901 Change working directory\nsetwd(\"~/Dropbox/PhD/pineapple/output/census\")\nload(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1901/NSW-1901-census-02-636.Rda\")\nold_data <- page_data\nfor (i in seq(637, 649)) {\n    new_file_name = paste(\"/Users/rohanalexander/Dropbox/PhD/pineapple/data/census/1901/NSW-1901-census-02-\",\n        i, \".Rda\", sep = \"\")\n    load(new_file_name)\n    new_data <- page_data\n    if (ncol(old_data) == ncol(page_data)) {\n        old_data <- rbind(old_data, page_data)\n        print(paste(\"Done with \", i))\n    } else {\n        print(paste(\"Error with \", i, \" at \", Sys.time()))\n    }\n}\ncensus_data <- old_data\nrm(new_file_name, i, new_data, page_data, old_data)\n# Make the headings easier to work with\ncolnames(census_data) <- NULL\ncolnames(census_data) <- colnames(census_data, do.NULL = FALSE, prefix = \"X\")\n# Remove some debris rows\ncensus_data <- filter(census_data, X2 != \"Population.\")\n# Isolate county names in a separate column. They seem to end with '—'\ncensus_data$dash <- regexpr(\"—$\", census_data$X1)\ncensus_data$dash <- ifelse((census_data$X1 == \"Lord Howe Island.\" | census_data$X1 == \"New South Wales.\"), 1,\n    census_data$dash)\ncensus_data$area_name <- ifelse(census_data$dash != -1, census_data$X1, NA)\ncensus_data$area_name1 <- lag(census_data$area_name, 1)\ncensus_data$area_name2 <- lag(census_data$area_name, 2)\ncensus_data$area_name3 <- lag(census_data$area_name, 3)\ncensus_data$area_name <- NA\ncensus_data$area_name <- ifelse(!is.na(census_data$area_name1), census_data$area_name1, census_data$area_name)\ncensus_data$area_name <- ifelse(!is.na(census_data$area_name2), census_data$area_name2, census_data$area_name)\ncensus_data$area_name <- ifelse(!is.na(census_data$area_name3), census_data$area_name3, census_data$area_name)\ncensus_data$area_name1 <- NULL\ncensus_data$area_name2 <- NULL\ncensus_data$area_name3 <- NULL\ncensus_data$dash <- NULL\ncensus_data <- filter(census_data, !is.na(area_name))\n# Remove the '—' from area_name\ncensus_data$area_name <- gsub(\"—\", \"\", census_data$area_name)\n# Reorder the columns\ncensus_data <- select(census_data, area_name, everything())\n# Covert all the number columns to numeric\ncols = c(3:(ncol(census_data)))\ncensus_data[, cols] %<>% lapply(function(x) gsub(\",\", \"\", x))\ncensus_data[, cols] %<>% lapply(function(x) as.numeric(as.character(x)))\nrm(cols)\n# Fix the column names\ncolnames(census_data) <- c(\"area_name\", \"sex\", \"Population\", \"Professional (including Government not elsewhere classed)\",\n    \"Domestic\", \"Commercial Pursuits\", \"Transport and Communication\", \"Industrial - Manufacturing\", \"Industrial - Building and Construction\",\n    \"Industrial - Indefinite\", \"Primary Producers - Agricultural\", \"Primary Producers - Pastoral\", \"Primary Producers - Dairying\",\n    \"Primary Producers - Mining\", \"Primary Producers - Other Primary Producers\", \"Indefinite Occupations\", \"Dependent\",\n    \"Occupation not stated\")\n# Save the data\nsave(census_data, file = \"1901/OccupationsByCounty.Rda\")\n",
    "created" : 1491802473544.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "652943425",
    "id" : "89623F0D",
    "lastKnownWriteTime" : 1491864240,
    "last_content_update" : 1491864240473,
    "path" : "~/Dropbox/PhD/pineapple/src/cleaning/organizeCensusData_occupations.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}